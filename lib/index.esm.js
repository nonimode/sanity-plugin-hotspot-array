function e(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function t(t){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?e(Object(r),!0).forEach((function(e){o(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function o(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}import{jsx as i,jsxs as r,Fragment as n}from"react/jsx-runtime";import a from"@sanity/image-url";import{Card as l,Text as c,Tooltip as s,Box as d,Stack as h,Flex as u}from"@sanity/ui";import{randomKey as p}from"@sanity/util/content";import m from"lodash/get";import f,{useEffect as g,useMemo as y,useCallback as b,useRef as v,useState as w}from"react";import{useClient as P,useFormValue as x,PatchEvent as O,setIfMissing as k,insert as j,set as D,definePlugin as E}from"sanity";import{useDebouncedCallback as _,useResizeObserver as H}from"@react-hookz/web";import{useMotionValue as R,motion as S}from"framer-motion";function T(e){let{children:t}=e;return i(l,{padding:4,radius:2,shadow:1,tone:"caution",children:i(c,{children:t})})}const C={width:"1.4rem",height:"1.4rem",position:"absolute",boxSizing:"border-box",top:0,left:0,margin:"-0.7rem 0 0 -0.7rem",cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"50%",background:"#000",color:"white"},M={background:"rgba(0, 0, 0, 0.1)",border:"1px solid #fff",cursor:"none"},N={background:"rgba(0, 0, 0, 0.1)",border:"1px solid #fff"},z={position:"absolute",left:"50%",top:"50%",height:"0.2rem",width:"0.2rem",margin:"-0.1rem 0 0 -0.1rem",background:"#fff",visibility:"hidden",borderRadius:"50%",pointerEvents:"none"},F={visibility:"visible"},I={color:"white",fontSize:"0.7rem",fontWeight:600,lineHeight:"1"},W={visibility:"hidden"},A=e=>Math.round(100*e)/100;function V(e){let{value:o,bounds:n,update:a,hotspotDescriptionPath:l,tooltip:h,index:u,schemaType:p,renderPreview:y}=e;const[b,v]=f.useState(!1),[w,P]=f.useState(!1),x=R(A(n.width*(o.x/100))),O=R(A(n.height*(o.y/100)));g((()=>{x.set(A(n.width*(o.x/100))),O.set(A(n.height*(o.y/100)))}),[x,O,o,n]);const k=f.useCallback((()=>{v(!1);const e=x.get(),t=O.get(),i=A(100*e/n.width),r=A(100*t/n.height),l=Math.max(0,Math.min(100,i)),c=Math.max(0,Math.min(100,r));a(o._key,l,c)}),[x,O,o,a,n]),j=f.useCallback((()=>v(!0)),[]),D=f.useCallback((()=>P(!0)),[]),E=f.useCallback((()=>P(!1)),[]);return x&&O?i(s,{disabled:b,portal:!0,content:h&&"function"==typeof h?f.createElement(h,{value:o,renderPreview:y,schemaType:p}):i(d,{padding:2,style:{maxWidth:200,pointerEvents:"none"},children:i(c,{textOverflow:"ellipsis",children:l?m(o,l):"".concat(o.x,"% x ").concat(o.y,"%")})}),children:r(S.div,{drag:!0,dragConstraints:n,dragElastic:0,dragMomentum:!1,onDragEnd:k,onDragStart:j,onHoverStart:D,onHoverEnd:E,style:t(t(t({},C),{},{x:x,y:O},b&&t({},M)),w&&t({},N)),children:[i(d,{style:t(t({},z),(b||w)&&t({},F))}),i("div",{style:t(t({},I),(b||w)&&t({},W)),children:u+1})]})},o._key):null}const X={width:"100%",height:"auto"},Y=["document","parent"];function q(e){var t;const{value:o,onChange:c,imageHotspotOptions:s,schemaType:d,renderPreview:f}=e,g=P({apiVersion:"2022-01-01"}),E=y((()=>{var t;return"document"===(Y.includes(null!=(t=s.pathRoot)?t:"")?s.pathRoot:"document")?[]:e.path.slice(0,-1)}),[s.pathRoot,e.path]),R=x(E),S=y((()=>m(R,s.imagePath)),[R,s.imagePath]),C=y((()=>{var e;if(a(g).dataset(null!=(e=g.config().dataset)?e:""),"cloudinary.asset"===(null==S?void 0:S.type)){return{width:Number(S.width),height:Number(S.height),url:String(S.secure_url)}}return null}),[S,g]),M=b((e=>{const{nativeEvent:t}=e,o=Number((100*t.offsetX/t.srcElement.width).toFixed(2)),i=Number((100*t.offsetY/t.srcElement.height).toFixed(2)),r="New Hotspot at ".concat(o,"% x ").concat(i,"%"),n={_key:p(12),_type:d.of[0].name,x:o,y:i};(null==s?void 0:s.descriptionPath)&&(n[s.descriptionPath]=r),c(O.from([k([]),j([n],"after",[-1])]))}),[s,c,d]),N=b(((e,t,o)=>{c(O.from([D(t,[{_key:e},"x"]),D(o,[{_key:e},"y"])]))}),[c]),z=v(null),[F,I]=w(),W=_((e=>I(e.contentRect)),[I],200);return H(z,W),r(h,{space:[2,2,3],children:[(null==C?void 0:C.url)?r("div",{style:{position:"relative"},children:[F&&(null!=(t=null==o?void 0:o.length)?t:0)>0&&(null==o?void 0:o.map(((e,t)=>i(V,{index:t,value:e,bounds:F,update:N,hotspotDescriptionPath:null==s?void 0:s.descriptionPath,tooltip:null==s?void 0:s.tooltip,renderPreview:f,schemaType:d.of[0]},e._key)))),i(l,{__unstable_checkered:!0,shadow:1,children:i(u,{align:"center",justify:"center",children:i("img",{ref:z,src:C.url,width:C.width,height:C.height,alt:"",style:X,onClick:M})})})]}):i(T,{children:s.imagePath?r(n,{children:["No Hotspot image found at path ",i("code",{children:s.imagePath})]}):r(n,{children:["Define a path in this field using to the image field in this document at"," ",i("code",{children:"options.hotspotImagePath"})]})}),s.pathRoot&&!Y.includes(s.pathRoot)&&r(T,{children:['The supplied imageHotspotPathRoot "',s.pathRoot,'" is not valid, falling back to "document". Available values are "',Y.join(", "),'".']}),e.renderDefault(e)]})}const B=E({name:"image-hotspot-array",form:{components:{input:e=>{var o,r;if("array"===e.schemaType.jsonType&&(null==(o=e.schemaType.options)?void 0:o.imageHotspot)){const o=null==(r=e.schemaType.options)?void 0:r.imageHotspot;if(o)return i(q,t(t({},e),{},{imageHotspotOptions:o}))}return e.renderDefault(e)}}}});export{q as ImageHotspotArray,B as imageHotspotArrayPlugin};
//# sourceMappingURL=index.esm.js.map
