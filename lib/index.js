"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function t(t){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?e(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(exports,"__esModule",{value:!0});var i=require("react/jsx-runtime"),n=require("@sanity/image-url"),o=require("@sanity/ui"),a=require("@sanity/util/content"),s=require("lodash/get"),l=require("react"),u=require("sanity"),c=require("@react-hookz/web"),d=require("framer-motion");function h(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=h(n),f=h(s),m=h(l);function g(e){let{children:t}=e;return i.jsx(o.Card,{padding:4,radius:2,shadow:1,tone:"caution",children:i.jsx(o.Text,{children:t})})}const b={width:"1.4rem",height:"1.4rem",position:"absolute",boxSizing:"border-box",top:0,left:0,margin:"-0.7rem 0 0 -0.7rem",cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"50%",background:"#000",color:"white"},y={background:"rgba(0, 0, 0, 0.1)",border:"1px solid #fff",cursor:"none"},x={background:"rgba(0, 0, 0, 0.1)",border:"1px solid #fff"},v={position:"absolute",left:"50%",top:"50%",height:"0.2rem",width:"0.2rem",margin:"-0.1rem 0 0 -0.1rem",background:"#fff",visibility:"hidden",borderRadius:"50%",pointerEvents:"none"},j={visibility:"visible"},w={color:"white",fontSize:"0.7rem",fontWeight:600,lineHeight:"1"},P={visibility:"hidden"},k=e=>Math.round(100*e)/100;function O(e){let{value:r,bounds:n,update:a,hotspotDescriptionPath:s,tooltip:u,index:c,schemaType:h,renderPreview:p}=e;const[g,O]=m.default.useState(!1),[C,E]=m.default.useState(!1),M=d.useMotionValue(k(n.width*(r.x/100))),_=d.useMotionValue(k(n.height*(r.y/100)));l.useEffect((()=>{M.set(k(n.width*(r.x/100))),_.set(k(n.height*(r.y/100)))}),[M,_,r,n]);const D=m.default.useCallback((()=>{O(!1);const e=M.get(),t=_.get(),i=k(100*e/n.width),o=k(100*t/n.height),s=Math.max(0,Math.min(100,i)),l=Math.max(0,Math.min(100,o));a(r._key,s,l)}),[M,_,r,a,n]),H=m.default.useCallback((()=>O(!0)),[]),R=m.default.useCallback((()=>E(!0)),[]),T=m.default.useCallback((()=>E(!1)),[]);return M&&_?i.jsx(o.Tooltip,{disabled:g,portal:!0,content:u&&"function"==typeof u?m.default.createElement(u,{value:r,renderPreview:p,schemaType:h}):i.jsx(o.Box,{padding:2,style:{maxWidth:200,pointerEvents:"none"},children:i.jsx(o.Text,{textOverflow:"ellipsis",children:s?f.default(r,s):"".concat(r.x,"% x ").concat(r.y,"%")})}),children:i.jsxs(d.motion.div,{drag:!0,dragConstraints:n,dragElastic:0,dragMomentum:!1,onDragEnd:D,onDragStart:H,onHoverStart:R,onHoverEnd:T,style:t(t(t({},b),{},{x:M,y:_},g&&t({},y)),C&&t({},x)),children:[i.jsx(o.Box,{style:t(t({},v),(g||C)&&t({},j))}),i.jsx("div",{style:t(t({},w),(g||C)&&t({},P)),children:c+1})]})},r._key):null}const C={width:"100%",height:"auto"},E=["document","parent"];function M(e){var t;const{value:r,onChange:n,imageHotspotOptions:s,schemaType:d,renderPreview:h}=e,m=u.useClient({apiVersion:"2022-01-01"}),b=l.useMemo((()=>{var t;return"document"===(E.includes(null!=(t=s.pathRoot)?t:"")?s.pathRoot:"document")?[]:e.path.slice(0,-1)}),[s.pathRoot,e.path]),y=u.useFormValue(b),x=l.useMemo((()=>f.default(y,s.imagePath)),[y,s.imagePath]),v=l.useMemo((()=>{var e;if(p.default(m).dataset(null!=(e=m.config().dataset)?e:""),"cloudinary.asset"===(null==x?void 0:x.type)){return{width:Number(x.width),height:Number(x.height),url:String(x.secure_url)}}return null}),[x,m]),j=l.useCallback((e=>{const{nativeEvent:t}=e,r=Number((100*t.offsetX/t.srcElement.width).toFixed(2)),i=Number((100*t.offsetY/t.srcElement.height).toFixed(2)),o="New Hotspot at ".concat(r,"% x ").concat(i,"%"),l={_key:a.randomKey(12),_type:d.of[0].name,x:r,y:i};(null==s?void 0:s.descriptionPath)&&(l[s.descriptionPath]=o),n(u.PatchEvent.from([u.setIfMissing([]),u.insert([l],"after",[-1])]))}),[s,n,d]),w=l.useCallback(((e,t,r)=>{n(u.PatchEvent.from([u.set(t,[{_key:e},"x"]),u.set(r,[{_key:e},"y"])]))}),[n]),P=l.useRef(null),[k,M]=l.useState(),_=c.useDebouncedCallback((e=>M(e.contentRect)),[M],200);return c.useResizeObserver(P,_),i.jsxs(o.Stack,{space:[2,2,3],children:[(null==v?void 0:v.url)?i.jsxs("div",{style:{position:"relative"},children:[k&&(null!=(t=null==r?void 0:r.length)?t:0)>0&&(null==r?void 0:r.map(((e,t)=>i.jsx(O,{index:t,value:e,bounds:k,update:w,hotspotDescriptionPath:null==s?void 0:s.descriptionPath,tooltip:null==s?void 0:s.tooltip,renderPreview:h,schemaType:d.of[0]},e._key)))),i.jsx(o.Card,{__unstable_checkered:!0,shadow:1,children:i.jsx(o.Flex,{align:"center",justify:"center",children:i.jsx("img",{ref:P,src:v.url,width:v.width,height:v.height,alt:"",style:C,onClick:j})})})]}):i.jsx(g,{children:s.imagePath?i.jsxs(i.Fragment,{children:["No Hotspot image found at path ",i.jsx("code",{children:s.imagePath})]}):i.jsxs(i.Fragment,{children:["Define a path in this field using to the image field in this document at"," ",i.jsx("code",{children:"options.hotspotImagePath"})]})}),s.pathRoot&&!E.includes(s.pathRoot)&&i.jsxs(g,{children:['The supplied imageHotspotPathRoot "',s.pathRoot,'" is not valid, falling back to "document". Available values are "',E.join(", "),'".']}),e.renderDefault(e)]})}const _=u.definePlugin({name:"image-hotspot-array",form:{components:{input:e=>{var r,n;if("array"===e.schemaType.jsonType&&(null==(r=e.schemaType.options)?void 0:r.imageHotspot)){const r=null==(n=e.schemaType.options)?void 0:n.imageHotspot;if(r)return i.jsx(M,t(t({},e),{},{imageHotspotOptions:r}))}return e.renderDefault(e)}}}});exports.ImageHotspotArray=M,exports.imageHotspotArrayPlugin=_;
//# sourceMappingURL=index.js.map
